<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.azeroth.project.repository.ProductRepository">

    <sql id="SELECT_BASE">
        SELECT id, p_name, main_cate, sub_cate, p_img, detail, price, stock, p_rank
        FROM Product
    </sql>

    <select id="findById">
        <include refid="SELECT_BASE"/>
        WHERE id = #{param1}
    </select>

    <insert id="addProduct" flushCache="true" parameterType="com.azeroth.project.domain.ProductDomain" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        INSERT INTO Product
        (p_name, main_cate, sub_cate, p_img, detail, price, stock, p_rank)
        VALUES
        (#{p_name}, #{main_cate}, #{sub_cate}, #{p_img}, #{detail}, #{price}, #{stock}, #{p_rank})
    </insert>

    <select id="selectFromRow" resultType="com.azeroth.project.domain.ProductDomain">
        <include refid="SELECT_BASE"/>
        ORDER BY p_rank, p_name
        LIMIT #{param1}, #{param2}
    </select>

    <select id="listByCategory" resultType="com.azeroth.project.domain.ProductDomain">
        <include refid="SELECT_BASE"/>
        WHERE main_cate = #{param1} AND sub_cate = #{param2}
        ORDER BY p_rank, p_name
    </select>

    <select id="countAll" resultType="int">
        SELECT COUNT(id) FROM Product
    </select>

</mapper>