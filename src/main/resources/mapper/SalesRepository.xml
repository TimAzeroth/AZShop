<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.azeroth.project.repository.SalesRepository">

    <resultMap id="mapUserImp" type="com.azeroth.project.domain.UserDomain">
        <result column="username" property="username"/>
        <result column="id" property="id"/>
        <result column="nickname" property="nickname"/>
        <result column="email" property="email"/>
        <result column="phone" property="phone"/>
    </resultMap>

    <resultMap id="mapPdImp" type="com.azeroth.project.domain.ProductDomain">
        <result column="p_id" property="id"/>
    </resultMap>

    <resultMap id="addressImp" type="com.azeroth.project.domain.AddressDomain">
        <result column="user_id" property="user_id"/>
        <result column="address_name" property="address_name"/>
        <result column="address" property="address"/>
        <result column="address_detail" property="address_detail"/>
        <result column="postcode" property="postcode"/>
    </resultMap>

    <!-- 주문 / 결제 사용자 정보와 배송지 정보 불러오는 쿼리문 -->
    <select id="findSales" resultMap="mapUserImp, mapPdImp">
        select
            u.username "username",
            u.nickname "nickname",
            u.email "email",
            u.phone "phone",
            p.id "p_id"
        from
            user u,
            product p
        WHERE
            u.username = a.user_id
        AND
            u.username = #{username}
    </select>

    <select id="findSales" resultMap="addressImp">
        SELECT
            user_id,
            address_name,
            address,
            address_detail,
            postcode
        FROM
            address
        WHERE
            user_id = #{username}
        AND
            address_name = #{address_name}
    </select>

    <insert id="insert" flushCache="true"
            parameterType="com.azeroth.project.domain.SalesDomain"
    useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        INSERT INTO sales
            (u_username, p_id, amount, address, address_detail, postcode, deliveryreq)
        VALUES
            #{u_username}, #{p_id}, #{amount}, #{address}, #{address_detail}, #{postcode}, #{deliveryreq}
    </insert>

</mapper>